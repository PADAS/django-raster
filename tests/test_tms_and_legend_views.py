from unittest import skipIf

from django.core.urlresolvers import reverse
from django.test.utils import override_settings

from .raster_testcase import RasterTestCase

EMPTY_TILE = '\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x01\x00\x00\x00\x01\x00\x08\x06\x00\x00\x00\\r\xa8f\x00\x00\x01\x15IDATx\x9c\xed\xc11\x01\x00\x00\x00\xc2\xa0\xf5O\xedk\x08\xa0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00x\x03\x01<\x00\x01<\xedS\t\x00\x00\x00\x00IEND\xaeB`\x82'


@override_settings(RASTER_TILE_CACHE_TIMEOUT=0)
class RasterTmsTests(RasterTestCase):

    def test_tms_nonexisting_layer(self):
        url = reverse('tms', kwargs={
            'z': self.tile.tilez, 'y': self.tile.tiley, 'x': self.tile.tilex,
            'layer': 'raster_nonexistent.tif', 'format': '.png'
        })
        response = self.client.get(url)
        self.assertEqual(response.status_code, 404)

    def test_tms_nonexisting_tile(self):
        url = reverse('tms', kwargs={'z': 100, 'y': 0, 'x': 0, 'layer': 'raster.tif', 'format': '.png'})
        response = self.client.get(url)
        self.assertEqual(response['Content-type'], 'PNG')
        self.assertEqual(
            response.content,
            EMPTY_TILE
        )
        self.assertEqual(response.status_code, 200)

    def test_tms_existing_tile(self):
        # Get tms tile rendered with legend
        response = self.client.get(self.tile_url)
        self.assertEqual(response['Content-type'], 'PNG')
        self.assertEqual(
            response.content,
            '\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x01\x00\x00\x00\x01\x00\x08\x06\x00\x00\x00\\r\xa8f\x00\x00\x06{IDATx\x9c\xed\xdd\xe1m\xdb:\x10\x00`\xe7\xa1\x13t\x96\xce\xd2!3Kf\xc9\ny\xbf\x0c\xa8\x06e\x91\x12%\xf1x\xdf\x07\x14H\x93\x98\x96\x8b\xeaxGR\xe4\xe3\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x000\x94\x8f\xbb/\x00z\xfa\xfd\xe7\xef\xcf\xda\xcf\xbe\xbf>/\xf9\xff\xfe\xee\x1a\xf68\xf3\xba\xff;\xaba`|\xbf\xee\xbe\x00\xb8\xc2\xd1^\xf4\xd9\xab/\xdb\xf9\xfd\xe7\xef\xcf\x15YE\xaf\x8c\xe2y\xad\xcb\xf6d\x00L\xaf\xe7M\xfa\xeef\xfc\xfd\xe7\xefO\xef\xf4\xffl\x02\x00$\xa6\x04`\x1aW\xf4\xbe\xdf_\x9f\x1f\xcb\xf7)\x95\x06\x91\x08\x00L\xab\xd7M\xb9V\xeb\xbf\x8e\x07\xf4x\xaf\x16\xa5kZ^\xc7k\xb0*Q\x02@b\x02\x004xf\x03\xcb\x11\xf5\xabf\x03j\xb4f%\x02\x00lX\xbb\xb9Kc\x01W\xea1\xeb \x00@b\x06\x01\x99V\xcf\x11\xfae[\xd1\xe6\xfa\xdf\x11\x00\x08\xaftC\x96n\xd4\xd7\x11\xf2\xb5\xef\x95\xda\x1f\xa5\xc6\xafQ\xfal\xa5\xbf?\x1eJ\x00HM\x06\xc0\xb4\x96=\xe1Z\x0f\xfenm\xff\xda\xfa\xff\xf3\xae\xb8\xcd\xde\xacd\xf9\xba0i\r\xacY\xbb)\xd7R\xe1\xd2\xef\xb4\xb4;\x8a\x9a\xd9\x89\xad\xd7)\x01 1%\x00\xa1\xbd\xeb\xfd_\x7f\xb6\xd5c\xd6\x94\x03\xb3Q\x02\x10\xdaV\xfa_\xfa\xbd\x9a\xb4\xff\xe8t_M\xf9q\xa4\xdd5\xad\xe5\x8e\x12\x00\x12S\x020\x95\xb5Q\xfce\x8f^\x9b\r\x8c\xe6\x8ck\x15\x00H\xa3%}>\x9a\xbaG\x193P\x02@b\x02\x00!\xb5<\tW\xfb{\xcfRaO\xaa\x1d\xa9\x94XR\x020\x95\xadM;\x9f_o\xed\xa6Scm\\!\x12\x19\x00$&\x03`*\xefR\xf1\xadu\xfe5\xed\xde\xbd\t\xc8R\x8f\xf7\x97\x01\x10^\xa9n\xafY\x0f\xdfz\xf3\xefy\xed\xe8\x04\x00Hl\x8a(F>-O\xbc\x95^[\xd3\x83\x8f\xb2\x0bP\x8f\x01\xcb\xb5vd\x00L\xe9\xe8)\xc1#\xd5\xfag\x12\x00 1\xb3\x00L\xafe\xc4\x7f\xb4\xde\xfe\xec\x83M\x05\x00\xc2\xa9\xb9IG\x1f\xa5\xdf\xbb\x13Q\xef\x00\xa5\x04\x80\xc4d\x00LiOO9Z\xfa\x7f\x05\x01\x80\xa9\xd4\xec\x04|\xb4\xfd#\x07\x8e\xb4\x06\x99\xb3\xcf$P\x02@bC\x0f\x94@I\xefA\xc0\xbd\xa9\xff\x15\x19@\xcd\xd6\xdf{\xb7\x07\x7f<\x94\x00\x04\xd5+-\xbe\xab\xee\xefy\x1e\xc1\x912A\t@H\xcf\rA\x96\x7f\xee\xb8\x86;^\xfbx\xf4\x0b\x80\x02\x00$\xa6\x04 \xb4\xda\xd5}w.\x0c\xaa\xe9\xed\x8f^\xe3\xde\x9d\x8e\r\x02\x12N\xed\x89?{\xdbkq\xe4\xf4\xa0w\x87\x87\\\xb5lY\t\x00\x89\xc9\x00\x08\xa3e\x0f\x80\x96\x94\xf8\xae\x0c\xa0\xa6\xcd\x1aG\xdeW\x00 \x8c\xdas\x00{\xb7\x7f\xb5+\x03\x80\x12\x00\x123\x0b@x\xad\x99\xc1Y=}\xcb\xaa\xbdQ\xb2\r\x01\x80)E\xd8\x0f`-\x08\xb4N\xe9\xd5\x06:{\x02\x02\xff\x90\x01\x90\xc6\x95iwM\xef>\x02\x01\x80\xd0z\xa4\xfa\xa3\xd5\xe5\xad\xd6V\x11\xd6LQ*\x01 1\x19\x00\xa1\xed]\x03\xbf\xd6\xc6\xd9j\x96\xff^y=\x02\x00\xe1\x8d>\xe2_k\xcf>\x00{_\xfb\xa4\x04\x80\xc4\xa6\x88\x9c\xe4\xd0\xba\xbe\xff\x8cu\xfa\xef\xecM\xe1\xef|*P\t\xc04^o\x84#\xbb\xf7^\xa16`\x9c\xf99\x94\x00\x90\x98\x0c\x80\xa9\x9cu\x16\xc0\xf3\xeb\x9e\xc7v\xd5\xee\x14\xb4\xfc\xba\xf7\xe7\x13\x00\x98\xc6\xeb\xcdq\xd6\xc6\x9bg\x8d-\x9c}\xa8I\x89\x12\x00\x12\x93\x01\x10\xce\xa8\x83z\xad^3\x89;\x06-\x05\x00\xa6\xd23%_\x9bv\xdc\xda\x7f`\xcf5\xdc\x15\xd4\x94\x00\x90\x98\x0c\x80\x90\xae~r\xafu\xc4~\xcdh\xe5\x8b\x00@xWo\xfd5\x13%\x00$&\x00\x10\xd2\xf7\xd7\xe7G\xed\t\xbbG\xd3\xee\x9ei\xfb\x9d\x87\x99\x96(\x01\x08ck\xd7\x9b\xb3\x8cr\xb3\x9eA\x06\x00\x89\xc9\x00\x98\xdeH=\xb8Y\x008\xe8\xee\xe3\xbeG\xd0\xeb<C%\x00$&\x00\xc0\xc2\xd6\xec\xc2l\x94\x000\xb03\xa63\x97m\xca\x00 1\x19\x00\xe1\x9d\xf5\x04\xe0lJ\x9fM\x00 \xa4\xd17\xfc<\xa2\xe6T\xdf^\x94\x00\x90\x98\x0c\x80p\xbe\xbf>?fN\xd5_\x9d\xf9Ye\x00\x84\x97m\xea\xae\'\x01\x80\xd0"g\x02#<\x15(\x00@b\xc6\x00\x98F\xefs\x01\xaer\xe6u\x96J#\x0b\x81\x98^\x94\x9b\xffn\x02\x00$\xa6\x04 \xa4\xad=\xf8\xaf>\x1a<*\x01\x80\xf0\x8e>0s\xe4@\x8f\x91\xd5\xfc[(\x01 1\x19\x00\xd3{\xd7\xc3/{\xc9\xabg\x11F8\xcf@\x00 <\xab\x00\xf7S\x02@b"\'\xe9\xd4n*ze\tP\xfb^-\x03\x965%\x8d\x12\x80\xf0jg\x01j\xf6\x10\x18}&`\xef\x01\xa4k\xafS\x02@b2\x00\xd2\x18y\xb0\xb0\xe7\xc2\xa5\x96\xd7\x0b\x00L\xa3\xf6\x06\xbfb\xcb\xad\xad\x1bz\x94`\xa4\x04\x80\xc4\x86\x88Bp\xc4\x9e\xa5\xc0[\xaf\xd9\x93\x86\x1fY\xd8SS\x02\xd4\xb4\xbf\xb6]\xdaZ\xfbJ\x00\xc2[N\x8d\xf5\xda-x\xcf\xbe\x83\xa3\xcf \x94(\x01 1\x19\x00Sj9A8\xca\x19\x035\x19Fk\x16"\x000\x8d\x96\xb4\xbd\xb4\xa2.b\n\x7f\x94\x12\x00\x12\x93\x010\xa5\xadt>[oo)0\xa9<g\x04J\xff\xf1G\xbc\xf9\xef\xba&\x01\x00\x12S\x020\x95\xa8\xfb\xfb\xddu\xde\xa1\x0c\x80tF\x9f\xee[s\xc6u\x0b\x00\x90X\xc8H\x08[j\x9f\xf8\x8bV*\xf4f\x0c\x80)\xddUSG\xb0\x0c\x86J\x00HL\x00 \x05\xd9\xc0\xbf\x9ek$\x04\x00\xa6\xf5\xfd\xf5\xf9\xf1\xfa\x1c\xbc@\xf0/\x01\x00\x12\x13\x00H\xe35#x~\xef\xae\xeb\x19\x81Y\x00\xa6\xb75#pG\x10\x18\xa5\x14\x91\x01@b2\x00(\xb8\xebd\xe0\x1e\x9c\x0b\x00/\x96e\xc0\x08u\x7fi\'\xdf;\x1edR\x02@pG\x02\x9a\x00\x00\x89\xdd\x9e\n\xc1\xd5F9\x1e\xbc\x97\xd6s\x05\x97\xe5\x90\x0c\x80\x94jV\x05\x96\xd6\r\xccF\x00\x80\xc4\xa6\x8en\xb0f\xcfy\x82-m\xb6zM\xe3{\x1e\x17^z\xafg\x9b\xff\x03"C\xe6\x90$C\xcfq\x00\x00\x00\x00IEND\xaeB`\x82'
        )
        self.assertEqual(response.status_code, 200)

    @skipIf(True, 'Fails on CI environment.')
    def test_tms_existing_tile_without_legend(self):
        # Get tms tile for layer without legend
        self.rasterlayer.legend = None
        self.rasterlayer.save()
        response = self.client.get(self.tile_url)
        self.assertEqual(response['Content-type'], 'PNG')
        self.assertEqual(
            response.content,
            '\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x01\x00\x00\x00\x01\x00\x08\x06\x00\x00\x00\\r\xa8f\x00\x00\x06{IDATx\x9c\xed\xdd\xe1m\xdb:\x10\x00`\xe7\xa1\x13t\x96\xce\xd2!3Kf\xc9\ny\xbf\x0c\xa8\x06e\x91\x12%\xf1x\xdf\x07\x14H\x93\x98\x96\x8b\xeaxGR\xe4\xe3\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x000\x94\x8f\xbb/\x00z\xfa\xfd\xe7\xef\xcf\xda\xcf\xbe\xbf>/\xf9\xff\xfe\xee\x1a\xf68\xf3\xba\xff;\xaba`|\xbf\xee\xbe\x00\xb8\xc2\xd1^\xf4\xd9\xab/\xdb\xf9\xfd\xe7\xef\xcf\x15YE\xaf\x8c\xe2y\xad\xcb\xf6d\x00L\xaf\xe7M\xfa\xeef\xfc\xfd\xe7\xefO\xef\xf4\xffl\x02\x00$\xa6\x04`\x1aW\xf4\xbe\xdf_\x9f\x1f\xcb\xf7)\x95\x06\x91\x08\x00L\xab\xd7M\xb9V\xeb\xbf\x8e\x07\xf4x\xaf\x16\xa5kZ^\xc7k\xb0*Q\x02@b\x02\x004xf\x03\xcb\x11\xf5\xabf\x03j\xb4f%\x02\x00lX\xbb\xb9Kc\x01W\xea1\xeb \x00@b\x06\x01\x99V\xcf\x11\xfae[\xd1\xe6\xfa\xdf\x11\x00\x08\xaftC\x96n\xd4\xd7\x11\xf2\xb5\xef\x95\xda\x1f\xa5\xc6\xafQ\xfal\xa5\xbf?\x1eJ\x00HM\x06\xc0\xb4\x96=\xe1Z\x0f\xfenm\xff\xda\xfa\xff\xf3\xae\xb8\xcd\xde\xacd\xf9\xba0i\r\xacY\xbb)\xd7R\xe1\xd2\xef\xb4\xb4;\x8a\x9a\xd9\x89\xad\xd7)\x01 1%\x00\xa1\xbd\xeb\xfd_\x7f\xb6\xd5c\xd6\x94\x03\xb3Q\x02\x10\xdaV\xfa_\xfa\xbd\x9a\xb4\xff\xe8t_M\xf9q\xa4\xdd5\xad\xe5\x8e\x12\x00\x12S\x020\x95\xb5Q\xfce\x8f^\x9b\r\x8c\xe6\x8ck\x15\x00H\xa3%}>\x9a\xbaG\x193P\x02@b\x02\x00!\xb5<\tW\xfb{\xcfRaO\xaa\x1d\xa9\x94XR\x020\x95\xadM;\x9f_o\xed\xa6Scm\\!\x12\x19\x00$&\x03`*\xefR\xf1\xadu\xfe5\xed\xde\xbd\t\xc8R\x8f\xf7\x97\x01\x10^\xa9n\xafY\x0f\xdfz\xf3\xefy\xed\xe8\x04\x00Hl\x8a(F>-O\xbc\x95^[\xd3\x83\x8f\xb2\x0bP\x8f\x01\xcb\xb5vd\x00L\xe9\xe8)\xc1#\xd5\xfag\x12\x00 1\xb3\x00L\xafe\xc4\x7f\xb4\xde\xfe\xec\x83M\x05\x00\xc2\xa9\xb9IG\x1f\xa5\xdf\xbb\x13Q\xef\x00\xa5\x04\x80\xc4d\x00LiOO9Z\xfa\x7f\x05\x01\x80\xa9\xd4\xec\x04|\xb4\xfd#\x07\x8e\xb4\x06\x99\xb3\xcf$P\x02@bC\x0f\x94@I\xefA\xc0\xbd\xa9\xff\x15\x19@\xcd\xd6\xdf{\xb7\x07\x7f<\x94\x00\x04\xd5+-\xbe\xab\xee\xefy\x1e\xc1\x912A\t@H\xcf\rA\x96\x7f\xee\xb8\x86;^\xfbx\xf4\x0b\x80\x02\x00$\xa6\x04 \xb4\xda\xd5}w.\x0c\xaa\xe9\xed\x8f^\xe3\xde\x9d\x8e\r\x02\x12N\xed\x89?{\xdbkq\xe4\xf4\xa0w\x87\x87\\\xb5lY\t\x00\x89\xc9\x00\x08\xa3e\x0f\x80\x96\x94\xf8\xae\x0c\xa0\xa6\xcd\x1aG\xdeW\x00 \x8c\xdas\x00{\xb7\x7f\xb5+\x03\x80\x12\x00\x123\x0b@x\xad\x99\xc1Y=}\xcb\xaa\xbdQ\xb2\r\x01\x80)E\xd8\x0f`-\x08\xb4N\xe9\xd5\x06:{\x02\x02\xff\x90\x01\x90\xc6\x95iwM\xef>\x02\x01\x80\xd0z\xa4\xfa\xa3\xd5\xe5\xad\xd6V\x11\xd6LQ*\x01 1\x19\x00\xa1\xed]\x03\xbf\xd6\xc6\xd9j\x96\xff^y=\x02\x00\xe1\x8d>\xe2_k\xcf>\x00{_\xfb\xa4\x04\x80\xc4\xa6\x88\x9c\xe4\xd0\xba\xbe\xff\x8cu\xfa\xef\xecM\xe1\xef|*P\t\xc04^o\x84#\xbb\xf7^\xa16`\x9c\xf99\x94\x00\x90\x98\x0c\x80\xa9\x9cu\x16\xc0\xf3\xeb\x9e\xc7v\xd5\xee\x14\xb4\xfc\xba\xf7\xe7\x13\x00\x98\xc6\xeb\xcdq\xd6\xc6\x9bg\x8d-\x9c}\xa8I\x89\x12\x00\x12\x93\x01\x10\xce\xa8\x83z\xad^3\x89;\x06-\x05\x00\xa6\xd23%_\x9bv\xdc\xda\x7f`\xcf5\xdc\x15\xd4\x94\x00\x90\x98\x0c\x80\x90\xae~r\xafu\xc4~\xcdh\xe5\x8b\x00@xWo\xfd5\x13%\x00$&\x00\x10\xd2\xf7\xd7\xe7G\xed\t\xbbG\xd3\xee\x9ei\xfb\x9d\x87\x99\x96(\x01\x08ck\xd7\x9b\xb3\x8cr\xb3\x9eA\x06\x00\x89\xc9\x00\x98\xdeH=\xb8Y\x008\xe8\xee\xe3\xbeG\xd0\xeb<C%\x00$&\x00\xc0\xc2\xd6\xec\xc2l\x94\x000\xb03\xa63\x97m\xca\x00 1\x19\x00\xe1\x9d\xf5\x04\xe0lJ\x9fM\x00 \xa4\xd17\xfc<\xa2\xe6T\xdf^\x94\x00\x90\x98\x0c\x80p\xbe\xbf>?fN\xd5_\x9d\xf9Ye\x00\x84\x97m\xea\xae\'\x01\x80\xd0"g\x02#<\x15(\x00@b\xc6\x00\x98F\xefs\x01\xaer\xe6u\x96J#\x0b\x81\x98^\x94\x9b\xffn\x02\x00$\xa6\x04 \xa4\xad=\xf8\xaf>\x1a<*\x01\x80\xf0\x8e>0s\xe4@\x8f\x91\xd5\xfc[(\x01 1\x19\x00\xd3{\xd7\xc3/{\xc9\xabg\x11F8\xcf@\x00 <\xab\x00\xf7S\x02@b"\'\xe9\xd4n*ze\tP\xfb^-\x03\x965%\x8d\x12\x80\xf0jg\x01j\xf6\x10\x18}&`\xef\x01\xa4k\xafS\x02@b2\x00\xd2\x18y\xb0\xb0\xe7\xc2\xa5\x96\xd7\x0b\x00L\xa3\xf6\x06\xbfb\xcb\xad\xad\x1bz\x94`\xa4\x04\x80\xc4\x86\x88Bp\xc4\x9e\xa5\xc0[\xaf\xd9\x93\x86\x1fY\xd8SS\x02\xd4\xb4\xbf\xb6]\xdaZ\xfbJ\x00\xc2[N\x8d\xf5\xda-x\xcf\xbe\x83\xa3\xcf \x94(\x01 1\x19\x00Sj9A8\xca\x19\x035\x19Fk\x16"\x000\x8d\x96\xb4\xbd\xb4\xa2.b\n\x7f\x94\x12\x00\x12\x93\x010\xa5\xadt>[oo)0\xa9<g\x04J\xff\xf1G\xbc\xf9\xef\xba&\x01\x00\x12S\x020\x95\xa8\xfb\xfb\xddu\xde\xa1\x0c\x80tF\x9f\xee[s\xc6u\x0b\x00\x90X\xc8H\x08[j\x9f\xf8\x8bV*\xf4f\x0c\x80)\xddUSG\xb0\x0c\x86J\x00HL\x00 \x05\xd9\xc0\xbf\x9ek$\x04\x00\xa6\xf5\xfd\xf5\xf9\xf1\xfa\x1c\xbc@\xf0/\x01\x00\x12\x13\x00H\xe35#x~\xef\xae\xeb\x19\x81Y\x00\xa6\xb75#pG\x10\x18\xa5\x14\x91\x01@b2\x00(\xb8\xebd\xe0\x1e\x9c\x0b\x00/\x96e\xc0\x08u\x7fi\'\xdf;\x1edR\x02@pG\x02\x9a\x00\x00\x89\xdd\x9e\n\xc1\xd5F9\x1e\xbc\x97\xd6s\x05\x97\xe5\x90\x0c\x80\x94jV\x05\x96\xd6\r\xccF\x00\x80\xc4\xa6\x8en\xb0f\xcfy\x82-m\xb6zM\xe3{\x1e\x17^z\xafg\x9b\xff\x03"C\xe6\x90$C\xcfq\x00\x00\x00\x00IEND\xaeB`\x82'
        )
        self.assertEqual(response.status_code, 200)

    def test_tms_existing_tile_using_rasterlayer_id_in_url(self):
        url = reverse('tms', kwargs={
            'z': self.tile.tilez, 'y': self.tile.tiley, 'x': self.tile.tilex,
            'layer': self.rasterlayer.id, 'format': '.png'
        })

        # Get tms tile rendered with legend
        response = self.client.get(url)
        self.assertEqual(response['Content-type'], 'PNG')
        self.assertEqual(
            response.content,
            '\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x01\x00\x00\x00\x01\x00\x08\x06\x00\x00\x00\\r\xa8f\x00\x00\x06{IDATx\x9c\xed\xdd\xe1m\xdb:\x10\x00`\xe7\xa1\x13t\x96\xce\xd2!3Kf\xc9\ny\xbf\x0c\xa8\x06e\x91\x12%\xf1x\xdf\x07\x14H\x93\x98\x96\x8b\xeaxGR\xe4\xe3\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x000\x94\x8f\xbb/\x00z\xfa\xfd\xe7\xef\xcf\xda\xcf\xbe\xbf>/\xf9\xff\xfe\xee\x1a\xf68\xf3\xba\xff;\xaba`|\xbf\xee\xbe\x00\xb8\xc2\xd1^\xf4\xd9\xab/\xdb\xf9\xfd\xe7\xef\xcf\x15YE\xaf\x8c\xe2y\xad\xcb\xf6d\x00L\xaf\xe7M\xfa\xeef\xfc\xfd\xe7\xefO\xef\xf4\xffl\x02\x00$\xa6\x04`\x1aW\xf4\xbe\xdf_\x9f\x1f\xcb\xf7)\x95\x06\x91\x08\x00L\xab\xd7M\xb9V\xeb\xbf\x8e\x07\xf4x\xaf\x16\xa5kZ^\xc7k\xb0*Q\x02@b\x02\x004xf\x03\xcb\x11\xf5\xabf\x03j\xb4f%\x02\x00lX\xbb\xb9Kc\x01W\xea1\xeb \x00@b\x06\x01\x99V\xcf\x11\xfae[\xd1\xe6\xfa\xdf\x11\x00\x08\xaftC\x96n\xd4\xd7\x11\xf2\xb5\xef\x95\xda\x1f\xa5\xc6\xafQ\xfal\xa5\xbf?\x1eJ\x00HM\x06\xc0\xb4\x96=\xe1Z\x0f\xfenm\xff\xda\xfa\xff\xf3\xae\xb8\xcd\xde\xacd\xf9\xba0i\r\xacY\xbb)\xd7R\xe1\xd2\xef\xb4\xb4;\x8a\x9a\xd9\x89\xad\xd7)\x01 1%\x00\xa1\xbd\xeb\xfd_\x7f\xb6\xd5c\xd6\x94\x03\xb3Q\x02\x10\xdaV\xfa_\xfa\xbd\x9a\xb4\xff\xe8t_M\xf9q\xa4\xdd5\xad\xe5\x8e\x12\x00\x12S\x020\x95\xb5Q\xfce\x8f^\x9b\r\x8c\xe6\x8ck\x15\x00H\xa3%}>\x9a\xbaG\x193P\x02@b\x02\x00!\xb5<\tW\xfb{\xcfRaO\xaa\x1d\xa9\x94XR\x020\x95\xadM;\x9f_o\xed\xa6Scm\\!\x12\x19\x00$&\x03`*\xefR\xf1\xadu\xfe5\xed\xde\xbd\t\xc8R\x8f\xf7\x97\x01\x10^\xa9n\xafY\x0f\xdfz\xf3\xefy\xed\xe8\x04\x00Hl\x8a(F>-O\xbc\x95^[\xd3\x83\x8f\xb2\x0bP\x8f\x01\xcb\xb5vd\x00L\xe9\xe8)\xc1#\xd5\xfag\x12\x00 1\xb3\x00L\xafe\xc4\x7f\xb4\xde\xfe\xec\x83M\x05\x00\xc2\xa9\xb9IG\x1f\xa5\xdf\xbb\x13Q\xef\x00\xa5\x04\x80\xc4d\x00LiOO9Z\xfa\x7f\x05\x01\x80\xa9\xd4\xec\x04|\xb4\xfd#\x07\x8e\xb4\x06\x99\xb3\xcf$P\x02@bC\x0f\x94@I\xefA\xc0\xbd\xa9\xff\x15\x19@\xcd\xd6\xdf{\xb7\x07\x7f<\x94\x00\x04\xd5+-\xbe\xab\xee\xefy\x1e\xc1\x912A\t@H\xcf\rA\x96\x7f\xee\xb8\x86;^\xfbx\xf4\x0b\x80\x02\x00$\xa6\x04 \xb4\xda\xd5}w.\x0c\xaa\xe9\xed\x8f^\xe3\xde\x9d\x8e\r\x02\x12N\xed\x89?{\xdbkq\xe4\xf4\xa0w\x87\x87\\\xb5lY\t\x00\x89\xc9\x00\x08\xa3e\x0f\x80\x96\x94\xf8\xae\x0c\xa0\xa6\xcd\x1aG\xdeW\x00 \x8c\xdas\x00{\xb7\x7f\xb5+\x03\x80\x12\x00\x123\x0b@x\xad\x99\xc1Y=}\xcb\xaa\xbdQ\xb2\r\x01\x80)E\xd8\x0f`-\x08\xb4N\xe9\xd5\x06:{\x02\x02\xff\x90\x01\x90\xc6\x95iwM\xef>\x02\x01\x80\xd0z\xa4\xfa\xa3\xd5\xe5\xad\xd6V\x11\xd6LQ*\x01 1\x19\x00\xa1\xed]\x03\xbf\xd6\xc6\xd9j\x96\xff^y=\x02\x00\xe1\x8d>\xe2_k\xcf>\x00{_\xfb\xa4\x04\x80\xc4\xa6\x88\x9c\xe4\xd0\xba\xbe\xff\x8cu\xfa\xef\xecM\xe1\xef|*P\t\xc04^o\x84#\xbb\xf7^\xa16`\x9c\xf99\x94\x00\x90\x98\x0c\x80\xa9\x9cu\x16\xc0\xf3\xeb\x9e\xc7v\xd5\xee\x14\xb4\xfc\xba\xf7\xe7\x13\x00\x98\xc6\xeb\xcdq\xd6\xc6\x9bg\x8d-\x9c}\xa8I\x89\x12\x00\x12\x93\x01\x10\xce\xa8\x83z\xad^3\x89;\x06-\x05\x00\xa6\xd23%_\x9bv\xdc\xda\x7f`\xcf5\xdc\x15\xd4\x94\x00\x90\x98\x0c\x80\x90\xae~r\xafu\xc4~\xcdh\xe5\x8b\x00@xWo\xfd5\x13%\x00$&\x00\x10\xd2\xf7\xd7\xe7G\xed\t\xbbG\xd3\xee\x9ei\xfb\x9d\x87\x99\x96(\x01\x08ck\xd7\x9b\xb3\x8cr\xb3\x9eA\x06\x00\x89\xc9\x00\x98\xdeH=\xb8Y\x008\xe8\xee\xe3\xbeG\xd0\xeb<C%\x00$&\x00\xc0\xc2\xd6\xec\xc2l\x94\x000\xb03\xa63\x97m\xca\x00 1\x19\x00\xe1\x9d\xf5\x04\xe0lJ\x9fM\x00 \xa4\xd17\xfc<\xa2\xe6T\xdf^\x94\x00\x90\x98\x0c\x80p\xbe\xbf>?fN\xd5_\x9d\xf9Ye\x00\x84\x97m\xea\xae\'\x01\x80\xd0"g\x02#<\x15(\x00@b\xc6\x00\x98F\xefs\x01\xaer\xe6u\x96J#\x0b\x81\x98^\x94\x9b\xffn\x02\x00$\xa6\x04 \xa4\xad=\xf8\xaf>\x1a<*\x01\x80\xf0\x8e>0s\xe4@\x8f\x91\xd5\xfc[(\x01 1\x19\x00\xd3{\xd7\xc3/{\xc9\xabg\x11F8\xcf@\x00 <\xab\x00\xf7S\x02@b"\'\xe9\xd4n*ze\tP\xfb^-\x03\x965%\x8d\x12\x80\xf0jg\x01j\xf6\x10\x18}&`\xef\x01\xa4k\xafS\x02@b2\x00\xd2\x18y\xb0\xb0\xe7\xc2\xa5\x96\xd7\x0b\x00L\xa3\xf6\x06\xbfb\xcb\xad\xad\x1bz\x94`\xa4\x04\x80\xc4\x86\x88Bp\xc4\x9e\xa5\xc0[\xaf\xd9\x93\x86\x1fY\xd8SS\x02\xd4\xb4\xbf\xb6]\xdaZ\xfbJ\x00\xc2[N\x8d\xf5\xda-x\xcf\xbe\x83\xa3\xcf \x94(\x01 1\x19\x00Sj9A8\xca\x19\x035\x19Fk\x16"\x000\x8d\x96\xb4\xbd\xb4\xa2.b\n\x7f\x94\x12\x00\x12\x93\x010\xa5\xadt>[oo)0\xa9<g\x04J\xff\xf1G\xbc\xf9\xef\xba&\x01\x00\x12S\x020\x95\xa8\xfb\xfb\xddu\xde\xa1\x0c\x80tF\x9f\xee[s\xc6u\x0b\x00\x90X\xc8H\x08[j\x9f\xf8\x8bV*\xf4f\x0c\x80)\xddUSG\xb0\x0c\x86J\x00HL\x00 \x05\xd9\xc0\xbf\x9ek$\x04\x00\xa6\xf5\xfd\xf5\xf9\xf1\xfa\x1c\xbc@\xf0/\x01\x00\x12\x13\x00H\xe35#x~\xef\xae\xeb\x19\x81Y\x00\xa6\xb75#pG\x10\x18\xa5\x14\x91\x01@b2\x00(\xb8\xebd\xe0\x1e\x9c\x0b\x00/\x96e\xc0\x08u\x7fi\'\xdf;\x1edR\x02@pG\x02\x9a\x00\x00\x89\xdd\x9e\n\xc1\xd5F9\x1e\xbc\x97\xd6s\x05\x97\xe5\x90\x0c\x80\x94jV\x05\x96\xd6\r\xccF\x00\x80\xc4\xa6\x8en\xb0f\xcfy\x82-m\xb6zM\xe3{\x1e\x17^z\xafg\x9b\xff\x03"C\xe6\x90$C\xcfq\x00\x00\x00\x00IEND\xaeB`\x82'
        )
        self.assertEqual(response.status_code, 200)

    def test_tms_legend_query_arg(self):
        response = self.client.get(self.tile_url + '?legend=other')
        self.assertEqual(response['Content-type'], 'PNG')
        self.assertEqual(
            response.content,
            '\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x01\x00\x00\x00\x01\x00\x08\x06\x00\x00\x00\\r\xa8f\x00\x00\x06{IDATx\x9c\xed\xdd\xe1m\xdb:\x10\x00`\xe7\xa1\x8bt\x96\xce\xd2\xa92Kf\xc9(y\xbf\x0c\xa8\x06e\x91\x12%\xf1x\xdf\x07\x14H\x93\x98\x96\x8b\xeaxGR\xe4\xe3\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x000\x94\x8f\xbb/\x00z\xfa\xfb\xe7\xf7\xcf\xda\xcf>\xbf\xbe/\xf9\xff\xfe\xee\x1a\xf68\xf3\xba\xff;\xaba`|\xbf\xee\xbe\x00\xb8\xc2\xd1^\xf4\xd9\xab/\xdb\xf9\xfb\xe7\xf7\xcf\x15YE\xaf\x8c\xe2y\xad\xcb\xf6d\x00L\xaf\xe7M\xfa\xeef\xfc\xfb\xe7\xf7O\xef\xf4\xffl\x02\x00$\xa6\x04`\x1aW\xf4\xbe\x9f_\xdf\x1f\xcb\xf7)\x95\x06\x91\x08\x00L\xab\xd7M\xb9V\xeb\xbf\x8e\x07\xf4x\xaf\x16\xa5kZ^\xc7k\xb0*Q\x02@b\x02\x004xf\x03\xcb\x11\xf5\xabf\x03j\xb4f%\x02\x00lX\xbb\xb9Kc\x01W\xea1\xeb \x00@b\x06\x01\x99V\xcf\x11\xfae[\xd1\xe6\xfa\xdf\x11\x00\x08\xaftC\x96n\xd4\xd7\x11\xf2\xb5\xef\x95\xda\x1f\xa5\xc6\xafQ\xfal\xa5\xbf?\x1eJ\x00HM\x06\xc0\xb4\x96=\xe1Z\x0f\xfenm\xff\xda\xfa\xff\xf3\xae\xb8\xcd\xde\xacd\xf9\xba0i\r\xacY\xbb)\xd7R\xe1\xd2\xef\xb4\xb4;\x8a\x9a\xd9\x89\xad\xd7)\x01 1%\x00\xa1\xbd\xeb\xfd_\x7f\xb6\xd5c\xd6\x94\x03\xb3Q\x02\x10\xdaV\xfa_\xfa\xbd\x9a\xb4\xff\xe8t_M\xf9q\xa4\xdd5\xad\xe5\x8e\x12\x00\x12S\x020\x95\xb5Q\xfce\x8f^\x9b\r\x8c\xe6\x8ck\x15\x00H\xa3%}>\x9a\xbaG\x193P\x02@b\x02\x00!\xb5<\tW\xfb{\xcfRaO\xaa\x1d\xa9\x94XR\x020\x95\xadM;\x9f_o\xed\xa6Scm\\!\x12\x19\x00$&\x03`*\xefR\xf1\xadu\xfe5\xed\xde\xbd\t\xc8R\x8f\xf7\x97\x01\x10^\xa9n\xafY\x0f\xdfz\xf3\xefy\xed\xe8\x04\x00Hl\x8a(F>-O\xbc\x95^[\xd3\x83\x8f\xb2\x0bP\x8f\x01\xcb\xb5vd\x00L\xe9\xe8)\xc1#\xd5\xfag\x12\x00 1\xb3\x00L\xafe\xc4\x7f\xb4\xde\xfe\xec\x83M\x05\x00\xc2\xa9\xb9IG\x1f\xa5\xdf\xbb\x13Q\xef\x00\xa5\x04\x80\xc4d\x00LiOO9Z\xfa\x7f\x05\x01\x80\xa9\xd4\xec\x04|\xb4\xfd#\x07\x8e\xb4\x06\x99\xb3\xcf$P\x02@bC\x0f\x94@I\xefA\xc0\xbd\xa9\xff\x15\x19@\xcd\xd6\xdf{\xb7\x07\x7f<\x94\x00\x04\xd5+-\xbe\xab\xee\xefy\x1e\xc1\x912A\t@H\xcf\rA\x96\x7f\xee\xb8\x86;^\xfbx\xf4\x0b\x80\x02\x00$\xa6\x04 \xb4\xda\xd5}w.\x0c\xaa\xe9\xed\x8f^\xe3\xde\x9d\x8e\r\x02\x12N\xed\x89?{\xdbkq\xe4\xf4\xa0w\x87\x87\\\xb5lY\t\x00\x89\xc9\x00\x08\xa3e\x0f\x80\x96\x94\xf8\xae\x0c\xa0\xa6\xcd\x1aG\xdeW\x00 \x8c\xdas\x00{\xb7\x7f\xb5+\x03\x80\x12\x00\x123\x0b@x\xad\x99\xc1Y=}\xcb\xaa\xbdQ\xb2\r\x01\x80)E\xd8\x0f`-\x08\xb4N\xe9\xd5\x06:{\x02\x02\xff\x90\x01\x90\xc6\x95iwM\xef>\x02\x01\x80\xd0z\xa4\xfa\xa3\xd5\xe5\xad\xd6V\x11\xd6LQ*\x01 1\x19\x00\xa1\xed]\x03\xbf\xd6\xc6\xd9j\x96\xff^y=\x02\x00\xe1\x8d>\xe2_k\xcf>\x00{_\xfb\xa4\x04\x80\xc4\xa6\x88\x9c\xe4\xd0\xba\xbe\xff\x8cu\xfa\xef\xecM\xe1\xef|*P\t\xc04^o\x84#\xbb\xf7^\xa16`\x9c\xf99\x94\x00\x90\x98\x0c\x80\xa9\x9cu\x16\xc0\xf3\xeb\x9e\xc7v\xd5\xee\x14\xb4\xfc\xba\xf7\xe7\x13\x00\x98\xc6\xeb\xcdq\xd6\xc6\x9bg\x8d-\x9c}\xa8I\x89\x12\x00\x12\x93\x01\x10\xce\xa8\x83z\xad^3\x89;\x06-\x05\x00\xa6\xd23%_\x9bv\xdc\xda\x7f`\xcf5\xdc\x15\xd4\x94\x00\x90\x98\x0c\x80\x90\xae~r\xafu\xc4~\xcdh\xe5\x8b\x00@xWo\xfd5\x13%\x00$&\x00\x10\xd2\xe7\xd7\xf7G\xed\t\xbbG\xd3\xee\x9ei\xfb\x9d\x87\x99\x96(\x01\x08ck\xd7\x9b\xb3\x8cr\xb3\x9eA\x06\x00\x89\xc9\x00\x98\xdeH=\xb8Y\x008\xe8\xee\xe3\xbeG\xd0\xeb<C%\x00$&\x00\xc0\xc2\xd6\xec\xc2l\x94\x000\xb03\xa63\x97m\xca\x00 1\x19\x00\xe1\x9d\xf5\x04\xe0lJ\x9fM\x00 \xa4\xd17\xfc<\xa2\xe6T\xdf^\x94\x00\x90\x98\x0c\x80p>\xbf\xbe?fN\xd5_\x9d\xf9Ye\x00\x84\x97m\xea\xae\'\x01\x80\xd0"g\x02#<\x15(\x00@b\xc6\x00\x98F\xefs\x01\xaer\xe6u\x96J#\x0b\x81\x98^\x94\x9b\xffn\x02\x00$\xa6\x04 \xa4\xad=\xf8\xaf>\x1a<*\x01\x80\xf0\x8e>0s\xe4@\x8f\x91\xd5\xfc[(\x01 1\x19\x00\xd3{\xd7\xc3/{\xc9\xabg\x11F8\xcf@\x00 <\xab\x00\xf7S\x02@b"\'\xe9\xd4n*ze\tP\xfb^-\x03\x965%\x8d\x12\x80\xf0jg\x01j\xf6\x10\x18}&`\xef\x01\xa4k\xafS\x02@b2\x00\xd2\x18y\xb0\xb0\xe7\xc2\xa5\x96\xd7\x0b\x00L\xa3\xf6\x06\xbfb\xcb\xad\xad\x1bz\x94`\xa4\x04\x80\xc4\x86\x88Bp\xc4\x9e\xa5\xc0[\xaf\xd9\x93\x86\x1fY\xd8SS\x02\xd4\xb4\xbf\xb6]\xdaZ\xfbJ\x00\xc2[N\x8d\xf5\xda-x\xcf\xbe\x83\xa3\xcf \x94(\x01 1\x19\x00Sj9A8\xca\x19\x035\x19Fk\x16"\x000\x8d\x96\xb4\xbd\xb4\xa2.b\n\x7f\x94\x12\x00\x12\x93\x010\xa5\xadt>[oo)0\xa9<g\x04J\xff\xf1G\xbc\xf9\xef\xba&\x01\x00\x12S\x020\x95\xa8\xfb\xfb\xddu\xde\xa1\x0c\x80tF\x9f\xee[s\xc6u\x0b\x00\x90X\xc8H\x08[j\x9f\xf8\x8bV*\xf4f\x0c\x80)\xddUSG\xb0\x0c\x86J\x00HL\x00 \x05\xd9\xc0\xbf\x9ek$\x04\x00\xa6\xf5\xf9\xf5\xfd\xf1\xfa\x1c\xbc@\xf0/\x01\x00\x12\x13\x00H\xe35#x~\xef\xae\xeb\x19\x81Y\x00\xa6\xb75#pG\x10\x18\xa5\x14\x91\x01@b2\x00(\xb8\xebd\xe0\x1e\x9c\x0b\x00/\x96e\xc0\x08u\x7fi\'\xdf;\x1edR\x02@pG\x02\x9a\x00\x00\x89\xdd\x9e\n\xc1\xd5F9\x1e\xbc\x97\xd6s\x05\x97\xe5\x90\x0c\x80\x94jV\x05\x96\xd6\r\xccF\x00\x80\xc4\xa6\x8en\xb0f\xcfy\x82-m\xb6zM\xe3{\x1e\x17^z\xafg\x9b\xff\x03\x13\xcb\xed>\xfd\xcd\'\xd6\x00\x00\x00\x00IEND\xaeB`\x82'
        )
        self.assertEqual(response.status_code, 200)

    def test_tms_manual_colormap_query_arg(self):
        response = self.client.get(self.tile_url + '?colormap={"4": [101, 67, 33, 255]}')
        self.assertEqual(response['Content-type'], 'PNG')
        self.assertEqual(
            response.content,
            '\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x01\x00\x00\x00\x01\x00\x08\x06\x00\x00\x00\\r\xa8f\x00\x00\x06{IDATx\x9c\xed\xdd\xe1m\xdb:\x10\x00`\xe7\xa1\x8bt\x96\xce\xd2\xa92Kf\xc9(y\xbf\x0c\xa8\x06e\x91\x12%\xf1x\xdf\x07\x14H\x93\x98\x96\x8b\xeaxGR\xe4\xe3\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x000\x94\x8f\xbb/\x00z\xfa\xfb\xe7\xf7\xcf\xda\xcf>\xbf\xbe/\xf9\xff\xfe\xee\x1a\xf68\xf3\xba\xff;\xaba`|\xbf\xee\xbe\x00\xb8\xc2\xd1^\xf4\xd9\xab/\xdb\xf9\xfb\xe7\xf7\xcf\x15YE\xaf\x8c\xe2y\xad\xcb\xf6d\x00L\xaf\xe7M\xfa\xeef\xfc\xfb\xe7\xf7O\xef\xf4\xffl\x02\x00$\xa6\x04`\x1aW\xf4\xbe\x9f_\xdf\x1f\xcb\xf7)\x95\x06\x91\x08\x00L\xab\xd7M\xb9V\xeb\xbf\x8e\x07\xf4x\xaf\x16\xa5kZ^\xc7k\xb0*Q\x02@b\x02\x004xf\x03\xcb\x11\xf5\xabf\x03j\xb4f%\x02\x00lX\xbb\xb9Kc\x01W\xea1\xeb \x00@b\x06\x01\x99V\xcf\x11\xfae[\xd1\xe6\xfa\xdf\x11\x00\x08\xaftC\x96n\xd4\xd7\x11\xf2\xb5\xef\x95\xda\x1f\xa5\xc6\xafQ\xfal\xa5\xbf?\x1eJ\x00HM\x06\xc0\xb4\x96=\xe1Z\x0f\xfenm\xff\xda\xfa\xff\xf3\xae\xb8\xcd\xde\xacd\xf9\xba0i\r\xacY\xbb)\xd7R\xe1\xd2\xef\xb4\xb4;\x8a\x9a\xd9\x89\xad\xd7)\x01 1%\x00\xa1\xbd\xeb\xfd_\x7f\xb6\xd5c\xd6\x94\x03\xb3Q\x02\x10\xdaV\xfa_\xfa\xbd\x9a\xb4\xff\xe8t_M\xf9q\xa4\xdd5\xad\xe5\x8e\x12\x00\x12S\x020\x95\xb5Q\xfce\x8f^\x9b\r\x8c\xe6\x8ck\x15\x00H\xa3%}>\x9a\xbaG\x193P\x02@b\x02\x00!\xb5<\tW\xfb{\xcfRaO\xaa\x1d\xa9\x94XR\x020\x95\xadM;\x9f_o\xed\xa6Scm\\!\x12\x19\x00$&\x03`*\xefR\xf1\xadu\xfe5\xed\xde\xbd\t\xc8R\x8f\xf7\x97\x01\x10^\xa9n\xafY\x0f\xdfz\xf3\xefy\xed\xe8\x04\x00Hl\x8a(F>-O\xbc\x95^[\xd3\x83\x8f\xb2\x0bP\x8f\x01\xcb\xb5vd\x00L\xe9\xe8)\xc1#\xd5\xfag\x12\x00 1\xb3\x00L\xafe\xc4\x7f\xb4\xde\xfe\xec\x83M\x05\x00\xc2\xa9\xb9IG\x1f\xa5\xdf\xbb\x13Q\xef\x00\xa5\x04\x80\xc4d\x00LiOO9Z\xfa\x7f\x05\x01\x80\xa9\xd4\xec\x04|\xb4\xfd#\x07\x8e\xb4\x06\x99\xb3\xcf$P\x02@bC\x0f\x94@I\xefA\xc0\xbd\xa9\xff\x15\x19@\xcd\xd6\xdf{\xb7\x07\x7f<\x94\x00\x04\xd5+-\xbe\xab\xee\xefy\x1e\xc1\x912A\t@H\xcf\rA\x96\x7f\xee\xb8\x86;^\xfbx\xf4\x0b\x80\x02\x00$\xa6\x04 \xb4\xda\xd5}w.\x0c\xaa\xe9\xed\x8f^\xe3\xde\x9d\x8e\r\x02\x12N\xed\x89?{\xdbkq\xe4\xf4\xa0w\x87\x87\\\xb5lY\t\x00\x89\xc9\x00\x08\xa3e\x0f\x80\x96\x94\xf8\xae\x0c\xa0\xa6\xcd\x1aG\xdeW\x00 \x8c\xdas\x00{\xb7\x7f\xb5+\x03\x80\x12\x00\x123\x0b@x\xad\x99\xc1Y=}\xcb\xaa\xbdQ\xb2\r\x01\x80)E\xd8\x0f`-\x08\xb4N\xe9\xd5\x06:{\x02\x02\xff\x90\x01\x90\xc6\x95iwM\xef>\x02\x01\x80\xd0z\xa4\xfa\xa3\xd5\xe5\xad\xd6V\x11\xd6LQ*\x01 1\x19\x00\xa1\xed]\x03\xbf\xd6\xc6\xd9j\x96\xff^y=\x02\x00\xe1\x8d>\xe2_k\xcf>\x00{_\xfb\xa4\x04\x80\xc4\xa6\x88\x9c\xe4\xd0\xba\xbe\xff\x8cu\xfa\xef\xecM\xe1\xef|*P\t\xc04^o\x84#\xbb\xf7^\xa16`\x9c\xf99\x94\x00\x90\x98\x0c\x80\xa9\x9cu\x16\xc0\xf3\xeb\x9e\xc7v\xd5\xee\x14\xb4\xfc\xba\xf7\xe7\x13\x00\x98\xc6\xeb\xcdq\xd6\xc6\x9bg\x8d-\x9c}\xa8I\x89\x12\x00\x12\x93\x01\x10\xce\xa8\x83z\xad^3\x89;\x06-\x05\x00\xa6\xd23%_\x9bv\xdc\xda\x7f`\xcf5\xdc\x15\xd4\x94\x00\x90\x98\x0c\x80\x90\xae~r\xafu\xc4~\xcdh\xe5\x8b\x00@xWo\xfd5\x13%\x00$&\x00\x10\xd2\xe7\xd7\xf7G\xed\t\xbbG\xd3\xee\x9ei\xfb\x9d\x87\x99\x96(\x01\x08ck\xd7\x9b\xb3\x8cr\xb3\x9eA\x06\x00\x89\xc9\x00\x98\xdeH=\xb8Y\x008\xe8\xee\xe3\xbeG\xd0\xeb<C%\x00$&\x00\xc0\xc2\xd6\xec\xc2l\x94\x000\xb03\xa63\x97m\xca\x00 1\x19\x00\xe1\x9d\xf5\x04\xe0lJ\x9fM\x00 \xa4\xd17\xfc<\xa2\xe6T\xdf^\x94\x00\x90\x98\x0c\x80p>\xbf\xbe?fN\xd5_\x9d\xf9Ye\x00\x84\x97m\xea\xae\'\x01\x80\xd0"g\x02#<\x15(\x00@b\xc6\x00\x98F\xefs\x01\xaer\xe6u\x96J#\x0b\x81\x98^\x94\x9b\xffn\x02\x00$\xa6\x04 \xa4\xad=\xf8\xaf>\x1a<*\x01\x80\xf0\x8e>0s\xe4@\x8f\x91\xd5\xfc[(\x01 1\x19\x00\xd3{\xd7\xc3/{\xc9\xabg\x11F8\xcf@\x00 <\xab\x00\xf7S\x02@b"\'\xe9\xd4n*ze\tP\xfb^-\x03\x965%\x8d\x12\x80\xf0jg\x01j\xf6\x10\x18}&`\xef\x01\xa4k\xafS\x02@b2\x00\xd2\x18y\xb0\xb0\xe7\xc2\xa5\x96\xd7\x0b\x00L\xa3\xf6\x06\xbfb\xcb\xad\xad\x1bz\x94`\xa4\x04\x80\xc4\x86\x88Bp\xc4\x9e\xa5\xc0[\xaf\xd9\x93\x86\x1fY\xd8SS\x02\xd4\xb4\xbf\xb6]\xdaZ\xfbJ\x00\xc2[N\x8d\xf5\xda-x\xcf\xbe\x83\xa3\xcf \x94(\x01 1\x19\x00Sj9A8\xca\x19\x035\x19Fk\x16"\x000\x8d\x96\xb4\xbd\xb4\xa2.b\n\x7f\x94\x12\x00\x12\x93\x010\xa5\xadt>[oo)0\xa9<g\x04J\xff\xf1G\xbc\xf9\xef\xba&\x01\x00\x12S\x020\x95\xa8\xfb\xfb\xddu\xde\xa1\x0c\x80tF\x9f\xee[s\xc6u\x0b\x00\x90X\xc8H\x08[j\x9f\xf8\x8bV*\xf4f\x0c\x80)\xddUSG\xb0\x0c\x86J\x00HL\x00 \x05\xd9\xc0\xbf\x9ek$\x04\x00\xa6\xf5\xf9\xf5\xfd\xf1\xfa\x1c\xbc@\xf0/\x01\x00\x12\x13\x00H\xe35#x~\xef\xae\xeb\x19\x81Y\x00\xa6\xb75#pG\x10\x18\xa5\x14\x91\x01@b2\x00(\xb8\xebd\xe0\x1e\x9c\x0b\x00/\x96e\xc0\x08u\x7fi\'\xdf;\x1edR\x02@pG\x02\x9a\x00\x00\x89\xdd\x9e\n\xc1\xd5F9\x1e\xbc\x97\xd6s\x05\x97\xe5\x90\x0c\x80\x94jV\x05\x96\xd6\r\xccF\x00\x80\xc4\xa6\x8en\xb0f\xcfy\x82-m\xb6zM\xe3{\x1e\x17^z\xafg\x9b\xff\x03\x13\xcb\xed>\xfd\xcd\'\xd6\x00\x00\x00\x00IEND\xaeB`\x82'
        )
        self.assertEqual(response.status_code, 200)

    def test_tms_manual_colormap_query_arg_hex(self):
        response = self.client.get(self.tile_url + '?colormap={"4": "654321"}')
        self.assertEqual(response['Content-type'], 'PNG')
        self.assertEqual(
            response.content,
            '\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x01\x00\x00\x00\x01\x00\x08\x06\x00\x00\x00\\r\xa8f\x00\x00\x06{IDATx\x9c\xed\xdd\xe1m\xdb:\x10\x00`\xe7\xa1\x8bt\x96\xce\xd2\xa92Kf\xc9(y\xbf\x0c\xa8\x06e\x91\x12%\xf1x\xdf\x07\x14H\x93\x98\x96\x8b\xeaxGR\xe4\xe3\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x000\x94\x8f\xbb/\x00z\xfa\xfb\xe7\xf7\xcf\xda\xcf>\xbf\xbe/\xf9\xff\xfe\xee\x1a\xf68\xf3\xba\xff;\xaba`|\xbf\xee\xbe\x00\xb8\xc2\xd1^\xf4\xd9\xab/\xdb\xf9\xfb\xe7\xf7\xcf\x15YE\xaf\x8c\xe2y\xad\xcb\xf6d\x00L\xaf\xe7M\xfa\xeef\xfc\xfb\xe7\xf7O\xef\xf4\xffl\x02\x00$\xa6\x04`\x1aW\xf4\xbe\x9f_\xdf\x1f\xcb\xf7)\x95\x06\x91\x08\x00L\xab\xd7M\xb9V\xeb\xbf\x8e\x07\xf4x\xaf\x16\xa5kZ^\xc7k\xb0*Q\x02@b\x02\x004xf\x03\xcb\x11\xf5\xabf\x03j\xb4f%\x02\x00lX\xbb\xb9Kc\x01W\xea1\xeb \x00@b\x06\x01\x99V\xcf\x11\xfae[\xd1\xe6\xfa\xdf\x11\x00\x08\xaftC\x96n\xd4\xd7\x11\xf2\xb5\xef\x95\xda\x1f\xa5\xc6\xafQ\xfal\xa5\xbf?\x1eJ\x00HM\x06\xc0\xb4\x96=\xe1Z\x0f\xfenm\xff\xda\xfa\xff\xf3\xae\xb8\xcd\xde\xacd\xf9\xba0i\r\xacY\xbb)\xd7R\xe1\xd2\xef\xb4\xb4;\x8a\x9a\xd9\x89\xad\xd7)\x01 1%\x00\xa1\xbd\xeb\xfd_\x7f\xb6\xd5c\xd6\x94\x03\xb3Q\x02\x10\xdaV\xfa_\xfa\xbd\x9a\xb4\xff\xe8t_M\xf9q\xa4\xdd5\xad\xe5\x8e\x12\x00\x12S\x020\x95\xb5Q\xfce\x8f^\x9b\r\x8c\xe6\x8ck\x15\x00H\xa3%}>\x9a\xbaG\x193P\x02@b\x02\x00!\xb5<\tW\xfb{\xcfRaO\xaa\x1d\xa9\x94XR\x020\x95\xadM;\x9f_o\xed\xa6Scm\\!\x12\x19\x00$&\x03`*\xefR\xf1\xadu\xfe5\xed\xde\xbd\t\xc8R\x8f\xf7\x97\x01\x10^\xa9n\xafY\x0f\xdfz\xf3\xefy\xed\xe8\x04\x00Hl\x8a(F>-O\xbc\x95^[\xd3\x83\x8f\xb2\x0bP\x8f\x01\xcb\xb5vd\x00L\xe9\xe8)\xc1#\xd5\xfag\x12\x00 1\xb3\x00L\xafe\xc4\x7f\xb4\xde\xfe\xec\x83M\x05\x00\xc2\xa9\xb9IG\x1f\xa5\xdf\xbb\x13Q\xef\x00\xa5\x04\x80\xc4d\x00LiOO9Z\xfa\x7f\x05\x01\x80\xa9\xd4\xec\x04|\xb4\xfd#\x07\x8e\xb4\x06\x99\xb3\xcf$P\x02@bC\x0f\x94@I\xefA\xc0\xbd\xa9\xff\x15\x19@\xcd\xd6\xdf{\xb7\x07\x7f<\x94\x00\x04\xd5+-\xbe\xab\xee\xefy\x1e\xc1\x912A\t@H\xcf\rA\x96\x7f\xee\xb8\x86;^\xfbx\xf4\x0b\x80\x02\x00$\xa6\x04 \xb4\xda\xd5}w.\x0c\xaa\xe9\xed\x8f^\xe3\xde\x9d\x8e\r\x02\x12N\xed\x89?{\xdbkq\xe4\xf4\xa0w\x87\x87\\\xb5lY\t\x00\x89\xc9\x00\x08\xa3e\x0f\x80\x96\x94\xf8\xae\x0c\xa0\xa6\xcd\x1aG\xdeW\x00 \x8c\xdas\x00{\xb7\x7f\xb5+\x03\x80\x12\x00\x123\x0b@x\xad\x99\xc1Y=}\xcb\xaa\xbdQ\xb2\r\x01\x80)E\xd8\x0f`-\x08\xb4N\xe9\xd5\x06:{\x02\x02\xff\x90\x01\x90\xc6\x95iwM\xef>\x02\x01\x80\xd0z\xa4\xfa\xa3\xd5\xe5\xad\xd6V\x11\xd6LQ*\x01 1\x19\x00\xa1\xed]\x03\xbf\xd6\xc6\xd9j\x96\xff^y=\x02\x00\xe1\x8d>\xe2_k\xcf>\x00{_\xfb\xa4\x04\x80\xc4\xa6\x88\x9c\xe4\xd0\xba\xbe\xff\x8cu\xfa\xef\xecM\xe1\xef|*P\t\xc04^o\x84#\xbb\xf7^\xa16`\x9c\xf99\x94\x00\x90\x98\x0c\x80\xa9\x9cu\x16\xc0\xf3\xeb\x9e\xc7v\xd5\xee\x14\xb4\xfc\xba\xf7\xe7\x13\x00\x98\xc6\xeb\xcdq\xd6\xc6\x9bg\x8d-\x9c}\xa8I\x89\x12\x00\x12\x93\x01\x10\xce\xa8\x83z\xad^3\x89;\x06-\x05\x00\xa6\xd23%_\x9bv\xdc\xda\x7f`\xcf5\xdc\x15\xd4\x94\x00\x90\x98\x0c\x80\x90\xae~r\xafu\xc4~\xcdh\xe5\x8b\x00@xWo\xfd5\x13%\x00$&\x00\x10\xd2\xe7\xd7\xf7G\xed\t\xbbG\xd3\xee\x9ei\xfb\x9d\x87\x99\x96(\x01\x08ck\xd7\x9b\xb3\x8cr\xb3\x9eA\x06\x00\x89\xc9\x00\x98\xdeH=\xb8Y\x008\xe8\xee\xe3\xbeG\xd0\xeb<C%\x00$&\x00\xc0\xc2\xd6\xec\xc2l\x94\x000\xb03\xa63\x97m\xca\x00 1\x19\x00\xe1\x9d\xf5\x04\xe0lJ\x9fM\x00 \xa4\xd17\xfc<\xa2\xe6T\xdf^\x94\x00\x90\x98\x0c\x80p>\xbf\xbe?fN\xd5_\x9d\xf9Ye\x00\x84\x97m\xea\xae\'\x01\x80\xd0"g\x02#<\x15(\x00@b\xc6\x00\x98F\xefs\x01\xaer\xe6u\x96J#\x0b\x81\x98^\x94\x9b\xffn\x02\x00$\xa6\x04 \xa4\xad=\xf8\xaf>\x1a<*\x01\x80\xf0\x8e>0s\xe4@\x8f\x91\xd5\xfc[(\x01 1\x19\x00\xd3{\xd7\xc3/{\xc9\xabg\x11F8\xcf@\x00 <\xab\x00\xf7S\x02@b"\'\xe9\xd4n*ze\tP\xfb^-\x03\x965%\x8d\x12\x80\xf0jg\x01j\xf6\x10\x18}&`\xef\x01\xa4k\xafS\x02@b2\x00\xd2\x18y\xb0\xb0\xe7\xc2\xa5\x96\xd7\x0b\x00L\xa3\xf6\x06\xbfb\xcb\xad\xad\x1bz\x94`\xa4\x04\x80\xc4\x86\x88Bp\xc4\x9e\xa5\xc0[\xaf\xd9\x93\x86\x1fY\xd8SS\x02\xd4\xb4\xbf\xb6]\xdaZ\xfbJ\x00\xc2[N\x8d\xf5\xda-x\xcf\xbe\x83\xa3\xcf \x94(\x01 1\x19\x00Sj9A8\xca\x19\x035\x19Fk\x16"\x000\x8d\x96\xb4\xbd\xb4\xa2.b\n\x7f\x94\x12\x00\x12\x93\x010\xa5\xadt>[oo)0\xa9<g\x04J\xff\xf1G\xbc\xf9\xef\xba&\x01\x00\x12S\x020\x95\xa8\xfb\xfb\xddu\xde\xa1\x0c\x80tF\x9f\xee[s\xc6u\x0b\x00\x90X\xc8H\x08[j\x9f\xf8\x8bV*\xf4f\x0c\x80)\xddUSG\xb0\x0c\x86J\x00HL\x00 \x05\xd9\xc0\xbf\x9ek$\x04\x00\xa6\xf5\xf9\xf5\xfd\xf1\xfa\x1c\xbc@\xf0/\x01\x00\x12\x13\x00H\xe35#x~\xef\xae\xeb\x19\x81Y\x00\xa6\xb75#pG\x10\x18\xa5\x14\x91\x01@b2\x00(\xb8\xebd\xe0\x1e\x9c\x0b\x00/\x96e\xc0\x08u\x7fi\'\xdf;\x1edR\x02@pG\x02\x9a\x00\x00\x89\xdd\x9e\n\xc1\xd5F9\x1e\xbc\x97\xd6s\x05\x97\xe5\x90\x0c\x80\x94jV\x05\x96\xd6\r\xccF\x00\x80\xc4\xa6\x8en\xb0f\xcfy\x82-m\xb6zM\xe3{\x1e\x17^z\xafg\x9b\xff\x03\x13\xcb\xed>\xfd\xcd\'\xd6\x00\x00\x00\x00IEND\xaeB`\x82'
        )
        self.assertEqual(response.status_code, 200)

    def test_tms_entries_query_arg(self):
        response = self.client.get(self.tile_url + '?entries=4&legend=dual')
        self.assertEqual(response['Content-type'], 'PNG')
        self.assertEqual(
            response.content,
            '\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x01\x00\x00\x00\x01\x00\x08\x06\x00\x00\x00\\r\xa8f\x00\x00\x06{IDATx\x9c\xed\xdd\xe1m\xdb:\x10\x00`\xe7\xa1\x8bt\x96\xce\xd2\xa92Kf\xc9(y\xbf\x0c\xa8\x06e\x91\x12%\xf1x\xdf\x07\x14H\x93\x98\x96\x8b\xeaxGR\xe4\xe3\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x000\x94\x8f\xbb/\x00z\xfa\xfb\xe7\xf7\xcf\xda\xcf>\xbf\xbe/\xf9\xff\xfe\xee\x1a\xf68\xf3\xba\xff;\xaba`|\xbf\xee\xbe\x00\xb8\xc2\xd1^\xf4\xd9\xab/\xdb\xf9\xfb\xe7\xf7\xcf\x15YE\xaf\x8c\xe2y\xad\xcb\xf6d\x00L\xaf\xe7M\xfa\xeef\xfc\xfb\xe7\xf7O\xef\xf4\xffl\x02\x00$\xa6\x04`\x1aW\xf4\xbe\x9f_\xdf\x1f\xcb\xf7)\x95\x06\x91\x08\x00L\xab\xd7M\xb9V\xeb\xbf\x8e\x07\xf4x\xaf\x16\xa5kZ^\xc7k\xb0*Q\x02@b\x02\x004xf\x03\xcb\x11\xf5\xabf\x03j\xb4f%\x02\x00lX\xbb\xb9Kc\x01W\xea1\xeb \x00@b\x06\x01\x99V\xcf\x11\xfae[\xd1\xe6\xfa\xdf\x11\x00\x08\xaftC\x96n\xd4\xd7\x11\xf2\xb5\xef\x95\xda\x1f\xa5\xc6\xafQ\xfal\xa5\xbf?\x1eJ\x00HM\x06\xc0\xb4\x96=\xe1Z\x0f\xfenm\xff\xda\xfa\xff\xf3\xae\xb8\xcd\xde\xacd\xf9\xba0i\r\xacY\xbb)\xd7R\xe1\xd2\xef\xb4\xb4;\x8a\x9a\xd9\x89\xad\xd7)\x01 1%\x00\xa1\xbd\xeb\xfd_\x7f\xb6\xd5c\xd6\x94\x03\xb3Q\x02\x10\xdaV\xfa_\xfa\xbd\x9a\xb4\xff\xe8t_M\xf9q\xa4\xdd5\xad\xe5\x8e\x12\x00\x12S\x020\x95\xb5Q\xfce\x8f^\x9b\r\x8c\xe6\x8ck\x15\x00H\xa3%}>\x9a\xbaG\x193P\x02@b\x02\x00!\xb5<\tW\xfb{\xcfRaO\xaa\x1d\xa9\x94XR\x020\x95\xadM;\x9f_o\xed\xa6Scm\\!\x12\x19\x00$&\x03`*\xefR\xf1\xadu\xfe5\xed\xde\xbd\t\xc8R\x8f\xf7\x97\x01\x10^\xa9n\xafY\x0f\xdfz\xf3\xefy\xed\xe8\x04\x00Hl\x8a(F>-O\xbc\x95^[\xd3\x83\x8f\xb2\x0bP\x8f\x01\xcb\xb5vd\x00L\xe9\xe8)\xc1#\xd5\xfag\x12\x00 1\xb3\x00L\xafe\xc4\x7f\xb4\xde\xfe\xec\x83M\x05\x00\xc2\xa9\xb9IG\x1f\xa5\xdf\xbb\x13Q\xef\x00\xa5\x04\x80\xc4d\x00LiOO9Z\xfa\x7f\x05\x01\x80\xa9\xd4\xec\x04|\xb4\xfd#\x07\x8e\xb4\x06\x99\xb3\xcf$P\x02@bC\x0f\x94@I\xefA\xc0\xbd\xa9\xff\x15\x19@\xcd\xd6\xdf{\xb7\x07\x7f<\x94\x00\x04\xd5+-\xbe\xab\xee\xefy\x1e\xc1\x912A\t@H\xcf\rA\x96\x7f\xee\xb8\x86;^\xfbx\xf4\x0b\x80\x02\x00$\xa6\x04 \xb4\xda\xd5}w.\x0c\xaa\xe9\xed\x8f^\xe3\xde\x9d\x8e\r\x02\x12N\xed\x89?{\xdbkq\xe4\xf4\xa0w\x87\x87\\\xb5lY\t\x00\x89\xc9\x00\x08\xa3e\x0f\x80\x96\x94\xf8\xae\x0c\xa0\xa6\xcd\x1aG\xdeW\x00 \x8c\xdas\x00{\xb7\x7f\xb5+\x03\x80\x12\x00\x123\x0b@x\xad\x99\xc1Y=}\xcb\xaa\xbdQ\xb2\r\x01\x80)E\xd8\x0f`-\x08\xb4N\xe9\xd5\x06:{\x02\x02\xff\x90\x01\x90\xc6\x95iwM\xef>\x02\x01\x80\xd0z\xa4\xfa\xa3\xd5\xe5\xad\xd6V\x11\xd6LQ*\x01 1\x19\x00\xa1\xed]\x03\xbf\xd6\xc6\xd9j\x96\xff^y=\x02\x00\xe1\x8d>\xe2_k\xcf>\x00{_\xfb\xa4\x04\x80\xc4\xa6\x88\x9c\xe4\xd0\xba\xbe\xff\x8cu\xfa\xef\xecM\xe1\xef|*P\t\xc04^o\x84#\xbb\xf7^\xa16`\x9c\xf99\x94\x00\x90\x98\x0c\x80\xa9\x9cu\x16\xc0\xf3\xeb\x9e\xc7v\xd5\xee\x14\xb4\xfc\xba\xf7\xe7\x13\x00\x98\xc6\xeb\xcdq\xd6\xc6\x9bg\x8d-\x9c}\xa8I\x89\x12\x00\x12\x93\x01\x10\xce\xa8\x83z\xad^3\x89;\x06-\x05\x00\xa6\xd23%_\x9bv\xdc\xda\x7f`\xcf5\xdc\x15\xd4\x94\x00\x90\x98\x0c\x80\x90\xae~r\xafu\xc4~\xcdh\xe5\x8b\x00@xWo\xfd5\x13%\x00$&\x00\x10\xd2\xe7\xd7\xf7G\xed\t\xbbG\xd3\xee\x9ei\xfb\x9d\x87\x99\x96(\x01\x08ck\xd7\x9b\xb3\x8cr\xb3\x9eA\x06\x00\x89\xc9\x00\x98\xdeH=\xb8Y\x008\xe8\xee\xe3\xbeG\xd0\xeb<C%\x00$&\x00\xc0\xc2\xd6\xec\xc2l\x94\x000\xb03\xa63\x97m\xca\x00 1\x19\x00\xe1\x9d\xf5\x04\xe0lJ\x9fM\x00 \xa4\xd17\xfc<\xa2\xe6T\xdf^\x94\x00\x90\x98\x0c\x80p>\xbf\xbe?fN\xd5_\x9d\xf9Ye\x00\x84\x97m\xea\xae\'\x01\x80\xd0"g\x02#<\x15(\x00@b\xc6\x00\x98F\xefs\x01\xaer\xe6u\x96J#\x0b\x81\x98^\x94\x9b\xffn\x02\x00$\xa6\x04 \xa4\xad=\xf8\xaf>\x1a<*\x01\x80\xf0\x8e>0s\xe4@\x8f\x91\xd5\xfc[(\x01 1\x19\x00\xd3{\xd7\xc3/{\xc9\xabg\x11F8\xcf@\x00 <\xab\x00\xf7S\x02@b"\'\xe9\xd4n*ze\tP\xfb^-\x03\x965%\x8d\x12\x80\xf0jg\x01j\xf6\x10\x18}&`\xef\x01\xa4k\xafS\x02@b2\x00\xd2\x18y\xb0\xb0\xe7\xc2\xa5\x96\xd7\x0b\x00L\xa3\xf6\x06\xbfb\xcb\xad\xad\x1bz\x94`\xa4\x04\x80\xc4\x86\x88Bp\xc4\x9e\xa5\xc0[\xaf\xd9\x93\x86\x1fY\xd8SS\x02\xd4\xb4\xbf\xb6]\xdaZ\xfbJ\x00\xc2[N\x8d\xf5\xda-x\xcf\xbe\x83\xa3\xcf \x94(\x01 1\x19\x00Sj9A8\xca\x19\x035\x19Fk\x16"\x000\x8d\x96\xb4\xbd\xb4\xa2.b\n\x7f\x94\x12\x00\x12\x93\x010\xa5\xadt>[oo)0\xa9<g\x04J\xff\xf1G\xbc\xf9\xef\xba&\x01\x00\x12S\x020\x95\xa8\xfb\xfb\xddu\xde\xa1\x0c\x80tF\x9f\xee[s\xc6u\x0b\x00\x90X\xc8H\x08[j\x9f\xf8\x8bV*\xf4f\x0c\x80)\xddUSG\xb0\x0c\x86J\x00HL\x00 \x05\xd9\xc0\xbf\x9ek$\x04\x00\xa6\xf5\xf9\xf5\xfd\xf1\xfa\x1c\xbc@\xf0/\x01\x00\x12\x13\x00H\xe35#x~\xef\xae\xeb\x19\x81Y\x00\xa6\xb75#pG\x10\x18\xa5\x14\x91\x01@b2\x00(\xb8\xebd\xe0\x1e\x9c\x0b\x00/\x96e\xc0\x08u\x7fi\'\xdf;\x1edR\x02@pG\x02\x9a\x00\x00\x89\xdd\x9e\n\xc1\xd5F9\x1e\xbc\x97\xd6s\x05\x97\xe5\x90\x0c\x80\x94jV\x05\x96\xd6\r\xccF\x00\x80\xc4\xa6\x8en\xb0f\xcfy\x82-m\xb6zM\xe3{\x1e\x17^z\xafg\x9b\xff\x03\x13\xcb\xed>\xfd\xcd\'\xd6\x00\x00\x00\x00IEND\xaeB`\x82'
        )
        self.assertEqual(response.status_code, 200)

    def test_tms_legend_url_from_layer_name(self):
        url = reverse('legend', kwargs={'layer_or_legend_name': 'raster.tif'})
        response = self.client.get(url)
        self.assertEqual(response.content, '[{"color": "#123456", "expression": "4", "name": "Earth"}]')
        self.assertEqual(response.status_code, 200)

    def test_tms_legend_url_error(self):
        url = reverse('legend', kwargs={'layer_or_legend_name': 'raster_does_not_exist.tif'})
        response = self.client.get(url)
        self.assertEqual(response.status_code, 404)

    def test_tms_legend_url_from_legend_name(self):
        url = reverse('legend', kwargs={'layer_or_legend_name': 'MyLegend'})
        response = self.client.get(url)
        self.assertEqual(response.content, '[{"color": "#123456", "expression": "4", "name": "Earth"}]')
        self.assertEqual(response.status_code, 200)
